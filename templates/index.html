<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Проверка состояния</title>
<link rel="stylesheet" href="/static/style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<h1>Проверка состояния</h1>
<p class="meta">Проверяется каждые 5 минут • Формат времени: UTC+3 (Москва)</p>

<div id="cards"></div>

<script>
function formatMoscowTime(isoString) {
  if (!isoString) {
    return "Недоступность не определена (она отсутствовала)";
  }

  const date = new Date(isoString);

  return date.toLocaleString("ru-RU", {
    timeZone: "Europe/Moscow",
    year: "numeric",
    month: "2-digit",
    day: "2-digit",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit"
  });
}

async function loadStatus() {
async function loadStatus() {
  const res = await fetch("/api/status");
  const data = await res.json();
  const container = document.getElementById("cards");
  container.innerHTML = "";

  data.forEach(site => {
    const card = document.createElement("div");
    card.className = "card " + (site.status === "Онлайн" ? "онлайн" : "оффлайн");

    card.innerHTML = `
      <h2>${site.url}</h2>
      <p>Текущее состояние: <strong>${site.status}</strong></p>
      <p>Последний офлайн: ${formatMoscowTime(site.last_downtime)}</p>
      ${site.last_error ? `<p class="error">${site.last_error}</p>` : ""}
    `;
    container.appendChild(card);
  });
}

loadStatus();
setInterval(loadStatus, 30000);
</script>

</body>
</html>